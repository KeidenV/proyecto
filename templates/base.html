<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Club Deportivo{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/search.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/themes.css') }}" rel="stylesheet">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: var(--primary-color);">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('main.index') }}">
                <i class="fas fa-dumbbell me-2"></i>Club Deportivo
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    {% if current_user.is_authenticated %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('main.dashboard') }}">
                                <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('main.calendar') }}">
                                <i class="fas fa-calendar-alt me-1"></i>Calendario
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('reports.index') }}">
                                <i class="fas fa-file-pdf me-1"></i>Reportes
                            </a>
                        </li>
                        
                        {% if current_user.role == 'admin' %}
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-cog me-1"></i>Administración
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="{{ url_for('admin.members') }}">Miembros</a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('admin.trainers') }}">Entrenadores</a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('admin.trainings') }}">Entrenamientos</a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('admin.competitions') }}">Competiciones</a></li>
                                </ul>
                            </li>
                        {% elif current_user.role == 'trainer' %}
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('trainer.trainings') }}">
                                    <i class="fas fa-running me-1"></i>Mis Entrenamientos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('trainer.members') }}">
                                    <i class="fas fa-users me-1"></i>Miembros
                                </a>
                            </li>
                        {% elif current_user.role == 'member' %}
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('member.trainings') }}">
                                    <i class="fas fa-running me-1"></i>Entrenamientos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('member.attendance') }}">
                                    <i class="fas fa-check-circle me-1"></i>Mi Asistencia
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('member.competitions') }}">
                                    <i class="fas fa-trophy me-1"></i>Competiciones
                                </a>
                            </li>
                        {% endif %}
                    {% endif %}
                </ul>
                
                <ul class="navbar-nav">
                    {% if current_user.is_authenticated %}
                        <li class="nav-item">
                            <button class="search-trigger" onclick="advancedSearch.openSearch()" title="Buscar (Ctrl+K)">
                                <i class="fas fa-search"></i>
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="notification-toggle" onclick="notificationSystem.toggleContainer()" title="Notificaciones">
                                <i class="fas fa-bell"></i>
                                <span class="notification-badge" id="notification-badge" style="display: none;">0</span>
                            </button>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user me-1"></i>{{ current_user.username }}
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{{ url_for('main.profile') }}">Mi Perfil</a></li>
                                {% if current_user.role == 'member' %}
                                    <li><a class="dropdown-item" href="{{ url_for('member.training_history') }}">Historial</a></li>
                                {% endif %}
                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#cookieSettingsModal"><i class="fas fa-cog me-2"></i>Configuración</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}">Cerrar Sesión</a></li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('auth.login') }}">
                                <i class="fas fa-sign-in-alt me-1"></i>Iniciar Sesión
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('auth.register') }}">
                                <i class="fas fa-user-plus me-1"></i>Registrarse
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="container mt-3">
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <main class="container mt-4">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="text-light mt-5 py-4" style="background-color: var(--dark-color);">
        <div class="container text-center">
            <p>&copy; 2024 Club Deportivo. Todos los derechos reservados.</p>
        </div>
    </footer>

    <!-- Modal de Configuración -->
    <div class="modal fade" id="cookieSettingsModal" tabindex="-1" aria-labelledby="cookieSettingsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="cookieSettingsModalLabel">
                        <i class="fas fa-cog me-2"></i>Configuración del Sistema
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Pestañas de configuración -->
                    <ul class="nav nav-tabs mb-4" id="configTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="appearance-tab" data-bs-toggle="tab" data-bs-target="#appearance" type="button" role="tab">
                                <i class="fas fa-palette me-2"></i>Apariencia
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="notifications-tab" data-bs-toggle="tab" data-bs-target="#notifications" type="button" role="tab">
                                <i class="fas fa-bell me-2"></i>Notificaciones
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab">
                                <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="privacy-tab" data-bs-toggle="tab" data-bs-target="#privacy" type="button" role="tab">
                                <i class="fas fa-shield-alt me-2"></i>Privacidad
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content" id="configTabsContent">
                        <!-- Pestaña de Apariencia -->
                        <div class="tab-pane fade show active" id="appearance" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-primary mb-3"><i class="fas fa-palette me-2"></i>Tema Visual</h6>
                                    
                                    <div class="mb-3">
                                        <label for="theme-selector" class="form-label">Tema Principal</label>
                                        <select class="form-select" id="theme-selector">
                                            <option value="light">Claro</option>
                                            <option value="dark">Oscuro</option>
                                            <option value="blue">Azul</option>
                                            <option value="green">Verde</option>
                                            <option value="purple">Púrpura</option>
                                            <option value="high-contrast">Alto Contraste</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="language-selector" class="form-label">Idioma</label>
                                        <select class="form-select" id="language-selector">
                                            <option value="es">Español</option>
                                            <option value="en">English</option>
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <label for="font-size" class="form-label">Tamaño de Fuente</label>
                                        <select class="form-select" id="font-size">
                                            <option value="small">Pequeño</option>
                                            <option value="medium" selected>Mediano</option>
                                            <option value="large">Grande</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <h6 class="text-primary mb-3"><i class="fas fa-eye me-2"></i>Vista Previa</h6>
                                    <div class="theme-preview p-3 border rounded">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="bg-primary text-white rounded-circle p-2 me-2">
                                                <i class="fas fa-user"></i>
                                            </div>
                                            <div>
                                                <h6 class="mb-0">Usuario de Prueba</h6>
                                                <small class="text-muted">Miembro del Club</small>
                                            </div>
                                        </div>
                                        <div class="bg-light p-2 rounded">
                                            <small class="text-muted">Esta es una vista previa de cómo se verá tu perfil con el tema seleccionado.</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pestaña de Notificaciones -->
                        <div class="tab-pane fade" id="notifications" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-primary mb-3"><i class="fas fa-bell me-2"></i>Configuración de Notificaciones</h6>
                                    
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="email-notifications">
                                        <label class="form-check-label" for="email-notifications">
                                            <i class="fas fa-envelope me-2"></i>Notificaciones por email
                                        </label>
                                    </div>
                                    
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="browser-notifications">
                                        <label class="form-check-label" for="browser-notifications">
                                            <i class="fas fa-bell me-2"></i>Notificaciones del navegador
                                        </label>
                                    </div>
                                    
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="sound-notifications">
                                        <label class="form-check-label" for="sound-notifications">
                                            <i class="fas fa-volume-up me-2"></i>Sonidos de notificación
                                        </label>
                                    </div>

                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="push-notifications">
                                        <label class="form-check-label" for="push-notifications">
                                            <i class="fas fa-mobile-alt me-2"></i>Notificaciones push
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <h6 class="text-primary mb-3"><i class="fas fa-cog me-2"></i>Configuración Avanzada</h6>
                                    
                                    <div class="mb-3">
                                        <label for="notification-frequency" class="form-label">Frecuencia de notificaciones</label>
                                        <select class="form-select" id="notification-frequency">
                                            <option value="immediate">Inmediata</option>
                                            <option value="hourly">Cada hora</option>
                                            <option value="daily">Diaria</option>
                                            <option value="weekly">Semanal</option>
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <label for="quiet-hours-start" class="form-label">Horario silencioso (inicio)</label>
                                        <input type="time" class="form-control" id="quiet-hours-start" value="22:00">
                                    </div>

                                    <div class="mb-3">
                                        <label for="quiet-hours-end" class="form-label">Horario silencioso (fin)</label>
                                        <input type="time" class="form-control" id="quiet-hours-end" value="08:00">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pestaña de Dashboard -->
                        <div class="tab-pane fade" id="dashboard" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-primary mb-3"><i class="fas fa-tachometer-alt me-2"></i>Configuración del Dashboard</h6>
                                    
                                    <div class="mb-3">
                                        <label for="default-view" class="form-label">Vista por defecto</label>
                                        <select class="form-select" id="default-view">
                                            <option value="cards">Tarjetas</option>
                                            <option value="table">Tabla</option>
                                            <option value="list">Lista</option>
                                            <option value="grid">Cuadrícula</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="items-per-page" class="form-label">Elementos por página</label>
                                        <select class="form-select" id="items-per-page">
                                            <option value="5">5</option>
                                            <option value="10" selected>10</option>
                                            <option value="25">25</option>
                                            <option value="50">50</option>
                                            <option value="100">100</option>
                                        </select>
                                    </div>

                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="auto-refresh">
                                        <label class="form-check-label" for="auto-refresh">
                                            <i class="fas fa-sync me-2"></i>Auto-actualización
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <h6 class="text-primary mb-3"><i class="fas fa-chart-bar me-2"></i>Widgets del Dashboard</h6>
                                    
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="show-welcome" checked>
                                        <label class="form-check-label" for="show-welcome">
                                            <i class="fas fa-hand-wave me-2"></i>Mensaje de bienvenida
                                        </label>
                                    </div>
                                    
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="show-stats" checked>
                                        <label class="form-check-label" for="show-stats">
                                            <i class="fas fa-chart-pie me-2"></i>Estadísticas
                                        </label>
                                    </div>
                                    
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="show-recent" checked>
                                        <label class="form-check-label" for="show-recent">
                                            <i class="fas fa-clock me-2"></i>Actividades recientes
                                        </label>
                                    </div>
                                    
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="show-calendar" checked>
                                        <label class="form-check-label" for="show-calendar">
                                            <i class="fas fa-calendar me-2"></i>Calendario
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pestaña de Privacidad -->
                        <div class="tab-pane fade" id="privacy" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-primary mb-3"><i class="fas fa-shield-alt me-2"></i>Configuración de Privacidad</h6>
                                    
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="profile-visible" checked>
                                        <label class="form-check-label" for="profile-visible">
                                            <i class="fas fa-user me-2"></i>Perfil visible para otros usuarios
                                        </label>
                                    </div>
                                    
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="activity-tracking">
                                        <label class="form-check-label" for="activity-tracking">
                                            <i class="fas fa-chart-line me-2"></i>Permitir seguimiento de actividad
                                        </label>
                                    </div>
                                    
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="data-analytics">
                                        <label class="form-check-label" for="data-analytics">
                                            <i class="fas fa-database me-2"></i>Compartir datos para análisis
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <h6 class="text-primary mb-3"><i class="fas fa-lock me-2"></i>Seguridad</h6>
                                    
                                    <div class="mb-3">
                                        <label for="session-timeout" class="form-label">Tiempo de sesión (minutos)</label>
                                        <select class="form-select" id="session-timeout">
                                            <option value="15">15 minutos</option>
                                            <option value="30" selected>30 minutos</option>
                                            <option value="60">1 hora</option>
                                            <option value="120">2 horas</option>
                                            <option value="0">Nunca</option>
                                        </select>
                                    </div>

                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="two-factor-auth">
                                        <label class="form-check-label" for="two-factor-auth">
                                            <i class="fas fa-key me-2"></i>Autenticación de dos factores
                                        </label>
                                    </div>

                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <small>Los cambios de seguridad requieren confirmación adicional.</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" onclick="saveCookieSettings()">
                        <i class="fas fa-save me-2"></i>Guardar Configuración
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/search.js') }}"></script>
    <script src="{{ url_for('static', filename='js/themes.js') }}"></script>
    <script src="{{ url_for('static', filename='js/cookies.js') }}"></script>
    
    <script>
        // Función para guardar configuración de cookies
        async function saveCookieSettings() {
            const settings = {
                theme: document.getElementById('theme-selector').value,
                language: document.getElementById('language-selector').value,
                notification_preferences: {
                    email_notifications: document.getElementById('email-notifications').checked,
                    browser_notifications: document.getElementById('browser-notifications').checked,
                    sound_notifications: document.getElementById('sound-notifications').checked
                },
                dashboard_preferences: {
                    default_view: document.getElementById('default-view').value,
                    items_per_page: parseInt(document.getElementById('items-per-page').value),
                    auto_refresh: document.getElementById('auto-refresh').checked,
                    show_welcome: document.getElementById('show-welcome').checked
                }
            };
            
            await cookieManager.savePreferences(settings);
            
            // Mostrar notificación de éxito
            cookieManager.showNotification(
                'Configuración Guardada',
                'Tus preferencias han sido guardadas exitosamente.',
                'success'
            );
            
            // Cerrar modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('cookieSettingsModal'));
            modal.hide();
        }
        
        // Cargar configuración al abrir el modal
        document.getElementById('cookieSettingsModal').addEventListener('show.bs.modal', function () {
            const prefs = cookieManager.preferences;
            
            // Cargar tema
            if (prefs.theme) {
                document.getElementById('theme-selector').value = prefs.theme;
            }
            
            // Cargar idioma
            if (prefs.language) {
                document.getElementById('language-selector').value = prefs.language;
            }
            
            // Cargar preferencias de notificaciones
            const notifPrefs = prefs.notification_preferences || {};
            document.getElementById('email-notifications').checked = notifPrefs.email_notifications || false;
            document.getElementById('browser-notifications').checked = notifPrefs.browser_notifications || false;
            document.getElementById('sound-notifications').checked = notifPrefs.sound_notifications || false;
            
            // Cargar preferencias del dashboard
            const dashPrefs = prefs.dashboard_preferences || {};
            document.getElementById('default-view').value = dashPrefs.default_view || 'cards';
            document.getElementById('items-per-page').value = dashPrefs.items_per_page || 10;
            document.getElementById('auto-refresh').checked = dashPrefs.auto_refresh || false;
            document.getElementById('show-welcome').checked = dashPrefs.show_welcome !== false;
        });
    </script>
    
    {% block scripts %}{% endblock %}
    {% block extra_js %}{% endblock %}
</body>
</html>
